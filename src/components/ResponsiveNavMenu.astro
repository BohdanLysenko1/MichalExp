---
const currentPath = Astro.url.pathname;
const isHomePage = currentPath === "/" || currentPath === "";

// Function to get the correct path for navigation
function getNavPath(anchor) {
  if (isHomePage) {
    return anchor; // Just the anchor on homepage
  } else {
    return `/${anchor}`; // Return to homepage with anchor
  }
}
---

<nav class="w-full h-20 flex items-center justify-between relative">
  <!-- Logo Section with Enhanced Styling -->
  <a href="/" class="flex items-center gap-4 p-2 group">
    <div class="relative">
      <img 
        src="/pictures/logo/logo2_nobackground.png" 
        alt="MichalExp Logo" 
        class="h-16 w-auto object-contain transition-transform duration-300 group-hover:scale-105" 
      />
      <div class="absolute inset-0 bg-gradient-to-r from-[color:var(--accent)] to-[color:var(--primary)] opacity-0 group-hover:opacity-10 rounded-lg transition-opacity duration-300"></div>
    </div>
    <div class="flex flex-col">
      <span class="font-display text-2xl lg:text-3xl font-bold text-[color:var(--primary)] transition-colors duration-300 group-hover:text-[color:var(--accent)]">
        MichalExp
      </span>
      <span class="text-xs text-[color:var(--muted-foreground)] font-medium tracking-wider uppercase">
        Remodeling Studio
      </span>
    </div>
  </a>

  <!-- Desktop Navigation -->
  <div class="hidden lg:flex items-center">
    <ul class="flex items-center gap-2">
      <li>
        <a 
          href="/" 
          class="nav-link px-5 py-3 rounded-full text-[color:var(--foreground)] font-medium hover:text-[color:var(--primary)] hover:bg-[color:var(--secondary)] transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-[color:var(--accent)] relative group"
        >
          Home
          <span class="absolute bottom-0 left-1/2 w-0 h-0.5 bg-[color:var(--accent)] transition-all duration-300 group-hover:w-full group-hover:left-0"></span>
        </a>
      </li>
      <li>
        <a 
          href={getNavPath("#services")} 
          class="nav-link px-5 py-3 rounded-full text-[color:var(--foreground)] font-medium hover:text-[color:var(--primary)] hover:bg-[color:var(--secondary)] transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-[color:var(--accent)] relative group"
        >
          Services
          <span class="absolute bottom-0 left-1/2 w-0 h-0.5 bg-[color:var(--accent)] transition-all duration-300 group-hover:w-full group-hover:left-0"></span>
        </a>
      </li>
      <li>
        <a 
          href={getNavPath("#portfolio")} 
          class="nav-link px-5 py-3 rounded-full text-[color:var(--foreground)] font-medium hover:text-[color:var(--primary)] hover:bg-[color:var(--secondary)] transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-[color:var(--accent)] relative group"
        >
          Portfolio
          <span class="absolute bottom-0 left-1/2 w-0 h-0.5 bg-[color:var(--accent)] transition-all duration-300 group-hover:w-full group-hover:left-0"></span>
        </a>
      </li>
      <li>
        <a 
          href={getNavPath("#testimonials")} 
          class="nav-link px-5 py-3 rounded-full text-[color:var(--foreground)] font-medium hover:text-[color:var(--primary)] hover:bg-[color:var(--secondary)] transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-[color:var(--accent)] relative group"
        >
          Reviews
          <span class="absolute bottom-0 left-1/2 w-0 h-0.5 bg-[color:var(--accent)] transition-all duration-300 group-hover:w-full group-hover:left-0"></span>
        </a>
      </li>
      <li>
        <a 
          href={getNavPath("#faq")} 
          class="nav-link px-5 py-3 rounded-full text-[color:var(--foreground)] font-medium hover:text-[color:var(--primary)] hover:bg-[color:var(--secondary)] transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-[color:var(--accent)] relative group"
        >
          FAQ
          <span class="absolute bottom-0 left-1/2 w-0 h-0.5 bg-[color:var(--accent)] transition-all duration-300 group-hover:w-full group-hover:left-0"></span>
        </a>
      </li>
    </ul>
    
    <!-- Premium CTA Button -->
    <div class="ml-6 pl-6 border-l border-[color:var(--border)]">
      <a 
        href={getNavPath("#contact")} 
        class="btn-primary inline-flex items-center gap-2 group"
      >
        <span>Get Free Estimate</span>
        <svg class="w-4 h-4 transition-transform duration-300 group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
        </svg>
      </a>
    </div>
  </div>

  <!-- Mobile Menu Button -->
  <button 
    id="mobile-menu-btn"
    class="lg:hidden p-2 rounded-lg text-[color:var(--foreground)] hover:bg-[color:var(--secondary)] transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-[color:var(--accent)]"
    aria-label="Toggle mobile menu"
  >
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
    </svg>
  </button>

  <!-- Mobile Menu Overlay -->
  <div 
    id="mobile-menu"
    class="lg:hidden fixed inset-0 z-50 bg-black/50 backdrop-blur-sm opacity-0 invisible transition-all duration-300"
  >
    <div class="absolute right-0 top-0 h-full w-80 max-w-[90vw] bg-white shadow-2xl transform translate-x-full transition-transform duration-300">
      <div class="p-6">
        <!-- Mobile Menu Header -->
        <div class="flex items-center justify-between mb-8">
          <div class="flex items-center gap-3">
            <img src="/pictures/logo/logo2_nobackground.png" alt="MichalExp Logo" class="h-10 w-auto" />
            <span class="font-display text-xl font-bold text-[color:var(--primary)]">MichalExp</span>
          </div>
          <button 
            id="mobile-menu-close"
            class="p-2 rounded-lg text-[color:var(--foreground)] hover:bg-[color:var(--secondary)] transition-colors duration-300"
            aria-label="Close mobile menu"
          >
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>

        <!-- Mobile Menu Links -->
        <nav class="space-y-2">
          <a href="/" class="mobile-nav-link block px-4 py-3 rounded-lg text-[color:var(--foreground)] font-medium hover:bg-[color:var(--secondary)] hover:text-[color:var(--primary)] transition-all duration-300">
            Home
          </a>
          <a href={getNavPath("#services")} class="mobile-nav-link block px-4 py-3 rounded-lg text-[color:var(--foreground)] font-medium hover:bg-[color:var(--secondary)] hover:text-[color:var(--primary)] transition-all duration-300">
            Services
          </a>
          <a href={getNavPath("#portfolio")} class="mobile-nav-link block px-4 py-3 rounded-lg text-[color:var(--foreground)] font-medium hover:bg-[color:var(--secondary)] hover:text-[color:var(--primary)] transition-all duration-300">
            Portfolio
          </a>
          <a href={getNavPath("#testimonials")} class="mobile-nav-link block px-4 py-3 rounded-lg text-[color:var(--foreground)] font-medium hover:bg-[color:var(--secondary)] hover:text-[color:var(--primary)] transition-all duration-300">
            Reviews
          </a>
          <a href={getNavPath("#faq")} class="mobile-nav-link block px-4 py-3 rounded-lg text-[color:var(--foreground)] font-medium hover:bg-[color:var(--secondary)] hover:text-[color:var(--primary)] transition-all duration-300">
            FAQ
          </a>
          
          <!-- Mobile CTA -->
          <div class="pt-6 mt-6 border-t border-[color:var(--border)]">
            <a href={getNavPath("#contact")} class="btn-primary w-full justify-center">
              Get Free Estimate
            </a>
          </div>
        </nav>
      </div>
    </div>
  </div>
</nav>

<script>
  // Mobile menu functionality
  document.addEventListener('DOMContentLoaded', () => {
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    const mobileMenuClose = document.getElementById('mobile-menu-close');
    const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');
    const menuPanel = mobileMenu?.querySelector('div');

    function openMobileMenu() {
      if (mobileMenu && menuPanel) {
        mobileMenu.classList.remove('opacity-0', 'invisible');
        setTimeout(() => {
          menuPanel.classList.remove('translate-x-full');
        }, 10);
        document.body.style.overflow = 'hidden';
      }
    }

    function closeMobileMenu() {
      if (mobileMenu && menuPanel) {
        menuPanel.classList.add('translate-x-full');
        setTimeout(() => {
          mobileMenu.classList.add('opacity-0', 'invisible');
          document.body.style.overflow = '';
        }, 300);
      }
    }

    mobileMenuBtn?.addEventListener('click', openMobileMenu);
    mobileMenuClose?.addEventListener('click', closeMobileMenu);
    
    // Close menu when clicking overlay
    mobileMenu?.addEventListener('click', (e) => {
      if (e.target === mobileMenu) {
        closeMobileMenu();
      }
    });

    // Close menu when clicking nav links
    mobileNavLinks.forEach(link => {
      link.addEventListener('click', closeMobileMenu);
    });

    // Close menu on escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeMobileMenu();
      }
    });
  });
</script>
